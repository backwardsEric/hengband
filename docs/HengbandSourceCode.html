<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN"
   "http://www.w3.org/TR/1998/REC-html40-19980424/strict.dtd">
<HTML>
  <HEAD lang="en">
    <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <TITLE>Hengband Application for macOS: Source Code</TITLE>
  </HEAD>

  <BODY>
    <H1>Hengband Application for macOS</H1>
    <P><A HREF="index.html">Binaries</A> | <A HREF="HengbandEnglishScreenshot.html">English screen shot</A> | <A HREF="HengbandJapaneseScreenshot.html">Japanese screen shot</A> | <A HREF="HengbandFeedback.html">Feedback</A> | Source code | <A HREF="HengbandChangeLog-3-0-0.html">3.0.0 Changes</A> | <A HREF="HengbandChangeLog.html">2.2.1.7 Changes</A> | <A HREF="HengbandChangeLog-1-6-2.html">1.6.2 Changes</A>
    <H1>Source Code</H1>
      <P>If you want to compile the code yourself or examine the changes I
        made, you can get one of the packaged source code archives,
        <A HREF="https://github.com/backwardsEric/hengband/releases/download/vmacos3.0.1-beta6/hengband-3.0.1-Beta6.tar.gz">hengband-3.0.1-Beta6.tar.gz</A>,
        <A HREF="https://github.com/backwardsEric/hengband/releases/download/vmacos2.2.1-7i/hengband-2.2.1.7i.tar.gz">hengband-2.2.1.7i.tar.gz</A>, or
        <A HREF="https://github.com/backwardsEric/hengband/releases/download/vmacos1.6.2-e/hengband-1.6.2e.tar.gz">hengband-1.6.2e.tar.gz</A>
        from <A HREF="https://github.com/backwardsEric/hengband/releases">https://github.com/backwardsEric/hengband/releases</A> .
        The first of those is based on Hengband's current development branch.
        The second is based on Hengband's development branch from 2019.  The
        third is based on Hengband's last stable release.  Alternately, you
        can clone the git repository, https://github.com/backwardsEric/hengband.git .
        Within the git repository, the macos-develop branch tracks Hengband's
        most recent upstream development (available as the develop branch).
        The macos-3-0-0 branch corresponds to the releases made for macOS with
        the 3.0.0 development code.  The macos-2-2-1 branch corresponds to the
        version based on 2.2.1.7.  The macos-1-6-2 branch corresponds to the
        version based on 1.6.2.
      <P>If you cloned the git repository and want to compile the code, you'll
       first need to create the configure script and some of the files it uses.
       If you're using the master, develop, or macos-develop branches, you'll
       need to set up the submodule that's used to handle the lib/xtra
       directory before creating the configure script.  To do that, run this
       in the top-level directory of the directory tree with the source code
       (also note that because the macos-develop branch uses a different
       version of the submodule and the macos-2-2-1 and macos-1-6-2 branches
       do not use the submodule, switching to or from those branches or branches
       based on them can require updating the submodule or moving the existing
       lib/xtra out of the way):
       <OL>
         <LI><CODE>git submodule init</CODE>
         <LI><CODE>git submodule update</CODE>
       </OL>
     <P>Now run this in the top-level directory of the directory tree with the
       source code to create the configure script (you'll need to have
       autoconf and automake in the path; at least for macOS 11 or 12 it is
       recommended to use autoconf 2.69 since the version of m4, GNU M4 1.4.6,
       included with macOS doesn't work well with autoconf 2.71):
       <OL>
         <LI><CODE>./bootstrap</CODE>
       </OL>
      <P>To compile the changed code and generate an English version of the game
        which uses the Cocoa user interface for macOS, run these commands from
        the top-level directory of the directory tree with the source code:
        <OL>
          <LI><CODE>./configure --disable-japanese --enable-cocoa</CODE>
          <LI><CODE>make install</CODE>
        </OL>
      <P>That will create the full application, hengband.app, in the top-level
        directory.  You can move that wherever you want.  If you want the
        curses interface or, if you have the X11 libraries installed, the X11
        interface, do not specify <CODE>--enable-cocoa</CODE> when
        running configure.  The curses or X11 interface will not use
        hengband.app.  Instead you'll get an executable, hengband, in the
        directory where you ran configure and that executable will pull
        information from the lib subdirectory there.  To get the Japanese
        version, do not specify <CODE>--disable-japanese</CODE> when running
        configure.  Compilation of the Japanese version requires the utility,
        nkf, unless you are building the code based on Hengband 1.6.2.
        Source code for that utility is available from
        <A HREF="https://osdn.net/projects/nkf/">https://osdn.net/projects/nkf/</A>.
      <P>To compile an English version that will run natively on either x86_64
        or arm machines, you can use these commands from the top-level directory
        of the directory tree with the source code if the source code is prior
        to the move to C++ (2021 March 6th; 3.0.0 Alpha 10):
        <OL>
          <LI><CODE>env CFLAGS="-g -O2 -arch x86_64 -arch arm64" OBJCFLAGS="-g -O2 -arch x86_64 -arch arm64" LDFLAGS="-arch x86_64 -arch arm64" ./configure --disable-dependency-tracking --enable-cocoa --disable-japanese</CODE>
          <LI><CODE>make install</CODE>
        </OL>
        For the C++-based code, these commands will work (needs source code
        newer than 2021 March 30th for the --disable-pch option to configure):
        <OL>
          <LI><CODE>env CFLAGS="-g -O2 -arch x86_64 -arch arm64" CXXFLAGS="-g -O2 -arch x86_64 -arch arm64" OBJCXXFLAGS="-g -O2 -arch x86_64 -arch arm64" LDFLAGS="-arch x86_64 -arch arm64" ./configure --disable-dependency-tracking --disable-pch --enable-cocoa --disable-japanese</CODE>
          <LI><CODE>make install</CODE>
        </OL>
      <P>For a Japanese version with a universal binary, the steps are much the
        same.  The only difference is to omit <CODE>--disable-japanese</CODE>
        when running configure.
      <P>Eventually, the hope is that the changes made here will be
        incorporated into the standard version of Hengband and you can get
        both the source code and binaries from them.
  </BODY>
</HTML>
