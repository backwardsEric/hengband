<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN"
   "http://www.w3.org/TR/1998/REC-html40-19980424/strict.dtd">
<HTML>
  <HEAD lang="en">
    <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <TITLE>Hengband Application for macOS: Source Code</TITLE>
  </HEAD>

  <BODY>
    <H1>Hengband Application for macOS</H1>
    <P><A HREF="index.html">Binaries</A> | <A HREF="HengbandEnglishScreenshot.html">English screen shot</A> | <A HREF="HengbandJapaneseScreenshot.html">Japanese screen shot</A> | <A HREF="HengbandFeedback.html">Feedback</A> | Source code | <A HREF="HengbandChangeLog.html">2.2.1.7 Changes</A> | <A HREF="HengbandChangeLog-1-6-2.html">1.6.2 Changes</A>
    <H1>Source Code</H1>
      <P>If you want to compile the code yourself or examine the changes I
        made, you can get one of the packaged source code archives,
        <A HREF="https://github.com/backwardsEric/hengband/releases/download/vmacos2.2.1-7f/hengband-2.2.1.7f.tar.gz">hengband-2.2.1.7f.tar.gz</A>
        is the latest for the version based on Hengband 2.2.1.7 and
        <A HREF="https://github.com/backwardsEric/hengband/releases/download/vmacos1.6.2-b/hengband-1.6.2b.tar.gz">hengband-1.6.2b.tar.gz</A>
        is the latest for the version based on Hengband 1.6.2, from
        <A HREF="https://osdn.net/projects/hengbandforosx/releases/">https://osdn.net/projbects/hengbandforosx/releases/</A> .
        Alternately, you can clone the git repository, https://github.com/backwardsEric/hengband.git .
        Within the git repository, the macos-2-2-1 branch corresponds to the
        version based on 2.2.1.7 and the macos-1-6-2 branch corresponds to
        the version based on 1.6.2.
      <P>If you cloned the git repository and want to compile the code, you'll
       first need to create the configure script and some of the files it uses.
       To do so, run this command in the top-level directory of the directory
       tree with the source code (you'll need to have autoconf and automake
       in the path):
       <OL>
         <LI><CODE>./bootstrap</CODE>
       </OL>
      <P>To compile the changed code and generate an English version of the game
        which uses the Cocoa user interface for macOS, run these commands from
        the top-level directory of the directory tree with the source code:
        <OL>
          <LI><CODE>./configure --disable-japanese --enable-cocoa</CODE>
          <LI><CODE>make install</CODE>
        </OL>
      <P>That will create the full application, hengband.app, in the top-level
        directory.  You can move that wherever you want.  If you want the
        curses interface or, if you have the X11 libraries installed, the X11
        interface, do not specify <CODE>--enable-cocoa</CODE> when
        running configure.  The curses or X11 interface will not use
        hengband.app.  Instead you'll get an executable, hengband, in the
        directory where you ran configure and that executable will pull
        information from the lib subdirectory there.  To get the Japanese
        version, do not specify <CODE>--disable-japanese</CODE> when running
        configure.  Compilation of the Japanese version requires the utility,
        nkf, unless you are building the code based on Hengband 1.6.2.
        Source code for that utility is available from
        <A HREF="https://osdn.net/projects/nkf/">https://osdn.net/projects/nkf/</A>.
      <P>To compile an English version that will run natively on either x86_64
        or arm machines, you can use these commands from the top-level directory
        of the directory tree with the source code if the source code is prior
        to the move to C++ (2021 March 6th; 3.0.0 Alpha 10):
        <OL>
          <LI><CODE>env CFLAGS="-arch x86_64 -arch arm64" OBJCFLAGS="-arch x86_64 -arch arm64" LDFLAGS="-arch x86_64 -arch arm64" ./configure --disable-dependency-tracking --enable-cocoa --disable-japanese</CODE>
          <LI><CODE>make install</CODE>
        </OL>
        For the C++-based code, these commands will work (needs source code
        newer than 2021 March 30th for the --disable-pch option to configure):
        <OL>
          <LI><CODE>env CFLAGS="-arch x86_64 -arch arm64" CXXFLAGS="-arch x86_64 -arch arm64" OBJCXXFLAGS="-arch x86_64 -arch arm64" LDFLAGS="-arch x86_64 -arch arm64" ./configure --disable-dependency-tracking --disable-pch --enable-cocoa --disable-japanese</CODE>
          <LI><CODE>make install</CODE>
        </OL>
      <P>For a Japanese version with a universal binary, the steps are much the
        same.  The only difference is to omit <CODE>--disable-japanese</CODE>
        when running configure.
      <P>Eventually, the hope is that the changes made here will be
        incorporated into the standard version of Hengband and you can get
        both the source code and binaries from them.
  </BODY>
</HTML>
